<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checagem Sensor</title>

    <!--CDN BOOTSTRAP-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />

    <!--CDN UNICONS-->
    <link
      rel="stylesheet"
      href="https://unicons.iconscout.com/release/v4.0.8/css/line.css"
    />

    <!--CDN DATATABLE-->
    <link
    href="https://cdn.datatables.net/v/bs5/jszip-3.10.1/dt-2.1.8/b-3.2.0/b-html5-3.2.0/b-print-3.2.0/datatables.min.css"
    rel="stylesheet"
  />


    <!-- MY CSS-->
     <link rel="stylesheet" th:href="@{/css/styles.css}" />

    <style></style>
  </head>
  <body>
    <!------------------------+Header+------------------------>
    <header></header>

    <!--------------------------+Navbar+-------------------------->
    <div th:replace="fragments/navbar :: navbar"></div>


    <!------------------------+Cotéudo do site+------------------------>

    <!--Container que realizará a organização/divisão entre a sidebar e o main-->
    <div class="wrapper">

    <!------------------------+SIDEBAR+------------------------>
    <div th:replace="fragments/sidebar :: sidebar"></div>

      <!------------------------+Main+------------------------>
      <main>
        <div class="my-main p-3 d-flex">
            <div class="container-fluid">

            <!-- Título da página -->
              <div class="row w-100">
                <h1>Checagem Sensor</h1>
                <hr>
              </div>

            <div class="row w-100">
              <div class="col-12 mb-3">
                <form action="" class="row mx-auto g-3">

                 <p>Ações:</p>   
                <!-- Seção para botões de ação -->
                <div class="col-6">
                <div class="btn-group">
                    <button type="button" class="btn btn-success" data-bs-toggle="collapse" data-bs-target="#inserir-tarefa" aria-expanded="false" aria-controls="inserir-tarefa" id="btn-inserir-tarefa">Inserir</button>
                    <button type="button" class="btn btn-warning" data-bs-toggle="collapse" data-bs-target="#editar-tarefa" aria-expanded="false" aria-controls="editar-tarefa" id="btn-editar-tarefa">Editar</button>
                </div>

                </div>

                <div class="col-6">
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">

                        <div class="acoes-inserir d-none" id="acoes-inserir">
                            <button type="button" class="btn btn-success" aria-expanded="false" aria-controls="" id="btn-confirmar-edicao">Confirmar</button>
                            <button type="button" class="btn btn-danger" aria-expanded="false" aria-controls="" id="btn-cancelar-edicao">Cancelar</button>
                        </div>

                        <div class="acoes-editar d-none" id="acoes-editar">
                            <button type="button" class="btn btn-success" data-bs-toggle="collapse" aria-expanded="false" aria-controls="inserir-tarefa" id="btn-confirmar-edicao">Confirmar</button>
                            <button type="button" class="btn btn-danger" data-bs-toggle="collapse" aria-expanded="false" aria-controls="editar-tarefa" id="btn-cancelar-edicao">Cancelar</button> 
                        </div>

                    </div>
                </div>
 

                </div>

                <!--Formulario Inserir-->
                <div class="row collapse mb-3 mt-3" id="inserir-tarefa">
                    <div class="col-2 mb-3">
                        <!-- Campo para exibir nome da transportadora -->
                        <label for="nome-transportadora" class="form-label">Transportadora:</label>
                        <input type="text" id="nome-transportadora" class="form-control" placeholder="Nome da Transportadora" aria-label="nome-transportadora">
                    </div>

                    <div class="col-2 mb-3">
                      <!-- Campo para exibir nome do Gestor -->
                      <label for="nome-gestor" class="form-label">Gestor:</label>
                      <input type="text" id="nome-gestor" class="form-control" placeholder="Nome do Gestor" aria-label="nome-gestor">
                  </div>

                    <div class="col-2 mb-3">
                        <!-- Campo para exibir placa do veiculo -->
                        <label for="placa-veiculo" class="form-label">Placa do Veículo:</label>
                        <input type="text" id="placa-veiculo" class="form-control" placeholder="Placa do Veículo" aria-label="placa-veiculo">
                    </div>
                    <div class="col-2 mb-3">
                        <!-- Campo para exibir equipamento -->
                        <label for="equipamento" class="form-label">Equipamento:</label>
                        <input type="text" id="equipamento" class="form-control" placeholder="Equipamento" aria-label="equipamento">
                    </div>
                    <div class="col-2 mb-3">
                      <!-- Campo para exibir tipo de vinculo -->
                      <label for="tipo-vinculo" class="form-label">Vínculo:</label>
                      <select class="form-select form-control" aria-label="tipo-vinculo" id="tipo-vinculo">
                        <option selected>Selecione...</option>
                        <option value="1">Agregado</option>
                        <option value="2">Fixo</option>
                        <option value="3">Terceiro</option>
                      </select>
                  </div>
                  <div class="col-2 mb-3">
                  <!-- Campo para exibir status da checagem-sensor -->
                    <label for="status-checagem-sensor" class="form-label">Status da checagem-sensor:</label>
                    <select class="form-select form-control" aria-label="status-checagem-sensor" id="status-checagem-sensor">
                      <option selected>Selecione...</option>
                      <option value="1">Aprovado</option>
                      <option value="2">Reprovado</option>
                      <option value="3">Aguardando</option>
                    </select>
                  </div>
                  <div class="col-2 mb-3">
                  <!-- Campo para exibir data de validade -->
                    <label for="data-validade" class="form-label">Data de Validade:</label>
                    <input type="date" id="data-validade" class="form-control" aria-label="data-validade">
                  </div>
                  <div class="col-2 mb-3">
                  <!-- Campo para exibir programacao -->
                    <label for="programacao" class="form-label">Programação:</label>
                    <input type="text" id="programacao" class="form-control" placeholder="Programação" aria-label="programacao">
                  </div>
                  <div class="col-2 mb-3">
                  <!-- Campo para exibir problema-equipamento -->
                    <label for="problema-equipamento" class="form-label">Problema do Equipamento:</label>
                    <input type="text" id="problema-equipamento" class="form-control" placeholder="Problema do Equipamento" aria-label="problema-equipamento">
                  </div>
                  <div class="col-2 mb-3">
                    <!-- Campo para exibir data de ínicio do problema -->
                      <label for="data-inicio-problema" class="form-label">Data de Ínicio do Problema:</label>
                      <input type="date" id="data-inicio-problema" class="form-control" aria-label="data-inicio-problema">
                  </div>
                  <div class="col-2 mb-3">
                    <!-- Campo para exibir observação -->
                      <label for="observacao" class="form-label">Observação:</label>
                      <input type="text" id="observacao" class="form-control" placeholder="Observação" aria-label="observacao">
                    </div>                  
                </div>

                <!--Formulario Editar-->
                <div class="row collapse mb-3 mt-3" id="editar-tarefa">
                  <div class="col-2 mb-3">
                    <!-- Campo para exibir data de inclusao (apenas leitura) -->
                    <label for="data-inclusao" class="form-label">Data de Inclusão:</label>
                    <input type="date" id="data-inclusao" class="form-control" aria-label="data-inclusao" disabled readonly>
                </div>                  
               <div class="col-2 mb-3">
                        <!-- Campo para exibir nome da transportadora -->
                        <label for="nome-transportadora" class="form-label">Transportadora:</label>
                        <input type="text" id="nome-transportadora" class="form-control" placeholder="Nome da Transportadora" aria-label="nome-transportadora">
                    </div>

                    <div class="col-2 mb-3">
                      <!-- Campo para exibir nome do Gestor -->
                      <label for="nome-gestor" class="form-label">Gestor:</label>
                      <input type="text" id="nome-gestor" class="form-control" placeholder="Nome do Gestor" aria-label="nome-gestor">
                  </div>

                    <div class="col-2 mb-3">
                        <!-- Campo para exibir placa do veiculo -->
                        <label for="placa-veiculo" class="form-label">Placa do Veículo:</label>
                        <input type="text" id="placa-veiculo" class="form-control" placeholder="Placa do Veículo" aria-label="placa-veiculo">
                    </div>
                    <div class="col-2 mb-3">
                        <!-- Campo para exibir equipamento -->
                        <label for="equipamento" class="form-label">Equipamento:</label>
                        <input type="text" id="equipamento" class="form-control" placeholder="Equipamento" aria-label="equipamento">
                    </div>
                    <div class="col-2 mb-3">
                      <!-- Campo para exibir tipo de vinculo -->
                      <label for="tipo-vinculo" class="form-label">Vínculo:</label>
                      <select class="form-select form-control" aria-label="tipo-vinculo" id="tipo-vinculo">
                        <option selected>Selecione...</option>
                        <option value="1">Agregado</option>
                        <option value="2">Fixo</option>
                        <option value="3">Terceiro</option>
                      </select>
                  </div>
                  <div class="col-2 mb-3">
                  <!-- Campo para exibir status da checagem-sensor -->
                    <label for="status-checagem-sensor" class="form-label">Status da checagem-sensor:</label>
                    <select class="form-select form-control" aria-label="status-checagem-sensor" id="status-checagem-sensor">
                      <option selected>Selecione...</option>
                      <option value="1">Aprovado</option>
                      <option value="2">Reprovado</option>
                      <option value="3">Aguardando</option>
                    </select>
                  </div>
                  <div class="col-2 mb-3">
                  <!-- Campo para exibir data de validade -->
                    <label for="data-validade" class="form-label">Data de Validade:</label>
                    <input type="date" id="data-validade" class="form-control" aria-label="data-validade">
                  </div>
                  <div class="col-2 mb-3">
                  <!-- Campo para exibir programacao -->
                    <label for="programacao" class="form-label">Programação:</label>
                    <input type="text" id="programacao" class="form-control" placeholder="Programação" aria-label="programacao">
                  </div>
                  <div class="col-2 mb-3">
                  <!-- Campo para exibir problema-equipamento -->
                    <label for="problema-equipamento" class="form-label">Problema do Equipamento:</label>
                    <input type="text" id="problema-equipamento" class="form-control" placeholder="Problema do Equipamento" aria-label="problema-equipamento">
                  </div>
                  <div class="col-2 mb-3">
                    <!-- Campo para exibir data de ínicio do problema -->
                      <label for="data-inicio-problema" class="form-label">Data de Ínicio do Problema:</label>
                      <input type="date" id="data-inicio-problema" class="form-control" aria-label="data-inicio-problema">
                  </div>
                  <div class="col-2 mb-3">
                    <!-- Campo para exibir observação -->
                      <label for="observacao" class="form-label">Observação:</label>
                      <input type="text" id="observacao" class="form-control" placeholder="Observação" aria-label="observacao">
                    </div>              
                    <div class="col-2 mb-3">
                      <!-- Campo para exibir usuario (apenas leitura) -->
                      <label for="usuario" class="form-label">Usuario:</label>
                      <input type="text" id="usuario" class="form-control" placeholder="Usuário"  aria-label="usuario" disabled readonly>
                  </div>                          
                </div>

                <hr>

                <!--DATATABLE-->
                <div class="col-12">
                <div class="data_table">
                <table id="datatable" class="table">
                    <thead>
                    <tr>
                    <th>#</th>
                    <th>Transportadora</th>
                    <th>Gestor</th>
                    <th>Placa</th>
                    <th>Equipamento</th>
                    <th>Vínculo</th>
                    <th>Status CL</th>
                    <th>Validade</th>
                    <th>Problema do Equipamento</th>
                    <th>Inicio do Problema</th>
                    <th>Observação</th>
                    <th>Usuario</th>
                    </tr>
                    </thead>
                    <tbody id="tbody-checagens">
                        
                    </tbody>
                </table>
              </div>
            </div>
            </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!------------------------+Footer+------------------------>
    <footer></footer>

    <!--JS-->
    <!--CDN BOOTSTRAP JS-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <!--JQUERY CDN-->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <!--CDN DATATABLE-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/v/bs5/jszip-3.10.1/dt-2.1.8/b-3.2.0/b-html5-3.2.0/b-print-3.2.0/datatables.min.js"></script>

    <!--AXIOS-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script th:src="@{/js/axios-config.js}"></script>
    <!--My script -->
    <script th:src="@{/js/script.js}"></script>
    <script th:src="@{/js/checagem-sensor.js}"></script>
    <!--<script th:src="@{/js/datatable.js}"></script>-->

    <script>

      document.addEventListener('DOMContentLoaded', () => {
      axios.get('/checagem-sensor')
        .then(response => {
          const tbody = document.querySelector('#datatable tbody');
          tbody.innerHTML = ""; // Limpa as linhas antigas

          response.data.forEach((checagem, index) => {
            const linha = document.createElement('tr');
            linha.innerHTML = `
              <td class="text-center align-middle">
                <input class="form-check-input" type="checkbox" data-id="${checagem.id}">
              </td>
              <td>${checagem.transportadora?.nome || ''}</td>
              <td>${checagem.gestor?.nome || ''}</td>
              <td>${checagem.veiculo?.placa || ''}</td>
              <td>${checagem.equipamento || ''}</td>
              <td>${checagem.vinculo || ''}</td>
              <td>${checagem.status || ''}</td>
              <td>${checagem.validade || ''}</td>
              <td>${checagem.problemaEquipamento || ''}</td>
              <td>${checagem.inicioProblema || ''}</td>
              <td>${checagem.observacao || ''}</td>
              <td>${checagem.usuarioInclusao?.nome || ''}</td>
            `;
            tbody.appendChild(linha);
          });

          /* Inicializar ou reinicializar o DataTables
          if ($.fn.DataTable.isDataTable('#datatable')) {
            $('#datatable').DataTable().clear().destroy();
          }*/
          /*---------------+DATATABLE+---------------*/
          $('#datatable').DataTable({
              layout: {
                  topStart: {
                      search: {
                          placeholder: 'Pesquise aqui...'
                      }
                  },
                  topEnd: {

                      pageLength: {
                          menu: [ 10, 25, 50, 100 ],
                      },
                      buttons:['copy', 'csv', 'excel', 'pdf', 'print']
                  },
                  bottomEnd: {
                      paging: {
                          numbers: 3
                      }
                  }
              },
              /*Definindo a linguagem do datatable para PT-BR */
              language: {
                  url: '/data/datatable-pt-BR.json'
              }

          });

        })
        .catch(error => {
          console.error('Erro ao buscar checagens:', error);
        });
    });
    </script>
  </body>
</html>
